import base64
import json
import os
import sys

sys.path.insert(0, os.path.join(os.path.dirname(__file__), '.'))

try:
    from pdf.nfse.nfse_evento import NfseEvento
except ImportError:
    from nfse_evento import NfseEvento

try:
    from nfse.nfse import Nfse
except ImportError:
    from nfse import Nfse

try:
    from nfse.config import NfseConfig
except ImportError:
    from config import NfseConfig


MARK_WATER = ['Cancelada', 'Substituida', 'Bloqueada']

class POST:
    def __init__(self):
        pass

    def generate_pdf(self, event: str):
        if isinstance(event, str):
            event = json.loads(event)

        body =event.get('body', {})

        if not body:
            return {
                'statusCode': 400,
                'body': 'No body found'
            }
        
        if isinstance(body, str):
            try:
                body = json.loads(body)
            except json.JSONDecodeError:
                return {
                    'statusCode': 400,
                    'body': 'Invalid JSON'
                }

        xml_original = body.get('xml_original', {})
        if not xml_original:
            return {
                'statusCode': 400,
                'body': 'No xml_original found'
            }

        #1 verificar se o xml é base64
        if isinstance(xml_original, str):
            try:
                xml_original = base64.b64decode(xml_original)
            except base64.binascii.Error:
                return {
                    'statusCode': 400,
                    'body': 'Invalid base64'
                }
        else:
            return {
                'statusCode': 400,
                'body': 'xml_original is not a string'
            }

        xml_evento = body.get('xml_evento', None)

        base_dir = os.path.dirname(os.path.abspath(__file__))
        logo_path = os.path.normpath(os.path.join(base_dir, "..", "assets", "Logo-Nfse.png"))
        config = NfseConfig(nfse_logo=logo_path)

        nfse = Nfse(xml_original, config=config)

        if xml_evento is not None:
            #2 verificar se o xml_evento é base64
            if isinstance(xml_evento, str):
                try:
                    xml_evento = base64.b64decode(xml_evento)
                except base64.binascii.Error:
                    return {
                        'statusCode': 400,
                        'body': 'Invalid base64'
                    }
            else:
                return {
                    'statusCode': 400,
                    'body': 'xml_evento is not a string'
                }

            nfse_evento = NfseEvento(xml_evento)
            evento = nfse_evento.find_event()
            if evento and evento in MARK_WATER:
                nfse.draw_watermark(evento.upper())

        # Converte o PDF gerado para base64 para ser retornado pela Lambda
        pdf_output = nfse.output(dest="S")
        if isinstance(pdf_output, str):
            pdf_bytes = pdf_output.encode("latin1")
        elif isinstance(pdf_output, (bytes, bytearray)):
            pdf_bytes = bytes(pdf_output)
        else:
            return {
                'statusCode': 500,
                'body': 'Unable to generate PDF bytes'
            }
        pdf_base64 = base64.b64encode(pdf_bytes).decode("utf-8")

        return {
            'statusCode': 200,
            'body': pdf_base64
        }        


if __name__ == "__main__":
    post = POST()
    post.generate_pdf({'body':{
        'xml_original': '''PE5GU2UgdmVyc2FvPSIxLjAxIiB4bWxucz0iaHR0cDovL3d3dy5zcGVkLmZhemVuZGEuZ292LmJy
L25mc2UiPgogICAgPGluZk5GU2UgSWQ9Ik5GUzMxMDYyMDAyMjMwMzQyMjY2MDAwMTgzMDAwMDAw
MDAxMDgwOTI2MDExOTM5OTQ2NTYyIj4KICAgICAgICA8eExvY0VtaT5CZWxvIEhvcml6b250ZTwv
eExvY0VtaT4KICAgICAgICA8eExvY1ByZXN0YWNhbz5CZWxvIEhvcml6b250ZTwveExvY1ByZXN0
YWNhbz4KICAgICAgICA8bk5GU2U+MTA4MDk8L25ORlNlPgogICAgICAgIDxjTG9jSW5jaWQ+MzEw
NjIwMDwvY0xvY0luY2lkPgogICAgICAgIDx4TG9jSW5jaWQ+QmVsbyBIb3Jpem9udGU8L3hMb2NJ
bmNpZD4KICAgICAgICA8eFRyaWJOYWM+QWdlbmNpYW1lbnRvIGUgaW50ZXJtZWRpYWNhbyBkZSBw
cm9ncmFtYXMgZGUgdHVyaXNtbywgcGFzc2Vpb3MsIHZpYWdlbnMsCiAgICAgICAgICAgIGV4Y3Vy
c29lcywgaG9zcGVkYWdlbnMgZSBjb25nZW5lcmVzLjwveFRyaWJOYWM+CiAgICAgICAgPHhUcmli
TXVuPkFnZW5jaWFtZW50bywgaW50ZXJtZWRpYWNhbyBlIHByb21vY2FvIGRlIHBhY290ZXMgZSBw
cm9ncmFtYXMgdHVyaXN0aWNvcywKICAgICAgICAgICAgcGFzc2Vpb3MsIHZpYWdlbnMsIGV4Y3Vy
c29lcywgaG9zcGVkYWdlbnMsIHJlc2VydmFzIGUgY29uZ2VuZXJlczwveFRyaWJNdW4+CiAgICAg
ICAgPHZlckFwbGljPlNlZmluTmFjaW9uYWxfMS40LjA8L3ZlckFwbGljPgogICAgICAgIDxhbWJH
ZXI+MjwvYW1iR2VyPgogICAgICAgIDx0cEVtaXM+MTwvdHBFbWlzPgogICAgICAgIDxwcm9jRW1p
PjE8L3Byb2NFbWk+CiAgICAgICAgPGNTdGF0PjEwMDwvY1N0YXQ+CiAgICAgICAgPGRoUHJvYz4y
MDI2LTAxLTAxVDA3OjE3OjIwLTAzOjAwPC9kaFByb2M+CiAgICAgICAgPG5ERlNlPjkyOTM2NTk8
L25ERlNlPgogICAgICAgIDxlbWl0PgogICAgICAgICAgICA8Q05QSj4zMDM0MjI2NjAwMDE4Mzwv
Q05QSj4KICAgICAgICAgICAgPHhOb21lPk9ORkxZIFRFQ05PTE9HSUEgTFREQTwveE5vbWU+CiAg
ICAgICAgICAgIDxlbmRlck5hYz4KICAgICAgICAgICAgICAgIDx4TGdyPlNBTlRBIENBVEFSSU5B
PC94TGdyPgogICAgICAgICAgICAgICAgPG5ybz40ODA8L25ybz4KICAgICAgICAgICAgICAgIDx4
QmFpcnJvPkxPVVJERVM8L3hCYWlycm8+CiAgICAgICAgICAgICAgICA8Y011bj4zMTA2MjAwPC9j
TXVuPgogICAgICAgICAgICAgICAgPFVGPk1HPC9VRj4KICAgICAgICAgICAgICAgIDxDRVA+MzAx
NzAwODE8L0NFUD4KICAgICAgICAgICAgPC9lbmRlck5hYz4KICAgICAgICAgICAgPGZvbmU+MzEz
MjIyMTg3NzwvZm9uZT4KICAgICAgICAgICAgPGVtYWlsPkZJTkFOQ0VJUk9AT05GTFkuQ09NLkJS
PC9lbWFpbD4KICAgICAgICA8L2VtaXQ+CiAgICAgICAgPHZhbG9yZXM+CiAgICAgICAgICAgIDx2
QkM+MjMyLjkzPC92QkM+CiAgICAgICAgICAgIDxwQWxpcUFwbGljPjMuMDA8L3BBbGlxQXBsaWM+
CiAgICAgICAgICAgIDx2SVNTUU4+Ni45OTwvdklTU1FOPgogICAgICAgICAgICA8dkxpcT4yMzIu
OTM8L3ZMaXE+CiAgICAgICAgPC92YWxvcmVzPgogICAgICAgIDxEUFMgdmVyc2FvPSIxLjAwIiB4
bWxucz0iaHR0cDovL3d3dy5zcGVkLmZhemVuZGEuZ292LmJyL25mc2UiPgogICAgICAgICAgICA8
aW5mRFBTIElkPSJEUFMzMTA2MjAwMjMwMzQyMjY2MDAwMTgzMDEwMDEwMDAwMDAwMDAwMTA4MjYi
PgogICAgICAgICAgICAgICAgPHRwQW1iPjE8L3RwQW1iPgogICAgICAgICAgICAgICAgPGRoRW1p
PjIwMjYtMDEtMDFUMDc6MDI6MTktMDM6MDA8L2RoRW1pPgogICAgICAgICAgICAgICAgPHZlckFw
bGljPm5vdGFnYXRld2F5X3YyLjAzPC92ZXJBcGxpYz4KICAgICAgICAgICAgICAgIDxzZXJpZT4x
MDAxPC9zZXJpZT4KICAgICAgICAgICAgICAgIDxuRFBTPjEwODI2PC9uRFBTPgogICAgICAgICAg
ICAgICAgPGRDb21wZXQ+MjAyNi0wMS0wMTwvZENvbXBldD4KICAgICAgICAgICAgICAgIDx0cEVt
aXQ+MTwvdHBFbWl0PgogICAgICAgICAgICAgICAgPGNMb2NFbWk+MzEwNjIwMDwvY0xvY0VtaT4K
ICAgICAgICAgICAgICAgIDxwcmVzdD4KICAgICAgICAgICAgICAgICAgICA8Q05QSj4zMDM0MjI2
NjAwMDE4MzwvQ05QSj4KICAgICAgICAgICAgICAgICAgICA8Zm9uZT4zMTM2NTY1MjA1PC9mb25l
PgogICAgICAgICAgICAgICAgICAgIDxlbWFpbD5maW5hbmNlaXJvQG9uZmx5LmNvbS5icjwvZW1h
aWw+CiAgICAgICAgICAgICAgICAgICAgPHJlZ1RyaWI+CiAgICAgICAgICAgICAgICAgICAgICAg
IDxvcFNpbXBOYWM+MTwvb3BTaW1wTmFjPgogICAgICAgICAgICAgICAgICAgICAgICA8cmVnRXNw
VHJpYj4wPC9yZWdFc3BUcmliPgogICAgICAgICAgICAgICAgICAgIDwvcmVnVHJpYj4KICAgICAg
ICAgICAgICAgIDwvcHJlc3Q+CiAgICAgICAgICAgICAgICA8dG9tYT4KICAgICAgICAgICAgICAg
ICAgICA8Q05QSj4yNjM2NjA1MjAwMDE3MDwvQ05QSj4KICAgICAgICAgICAgICAgICAgICA8eE5v
bWU+Q09NUEFOSElBIEJSQVNJTEVJUkEgREUgUExBTk9TIEZVTkVSQVJJT1MgUy9BPC94Tm9tZT4K
ICAgICAgICAgICAgICAgICAgICA8ZW5kPgogICAgICAgICAgICAgICAgICAgICAgICA8ZW5kTmFj
PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGNNdW4+MzE1NzgwNzwvY011bj4KICAgICAg
ICAgICAgICAgICAgICAgICAgICAgIDxDRVA+MzMxMjA1NjM8L0NFUD4KICAgICAgICAgICAgICAg
ICAgICAgICAgPC9lbmROYWM+CiAgICAgICAgICAgICAgICAgICAgICAgIDx4TGdyPkJBU0lMSUE8
L3hMZ3I+CiAgICAgICAgICAgICAgICAgICAgICAgIDxucm8+cy9uPC9ucm8+CiAgICAgICAgICAg
ICAgICAgICAgICAgIDx4QmFpcnJvPlNBTyBCRU5FRElUTzwveEJhaXJybz4KICAgICAgICAgICAg
ICAgICAgICA8L2VuZD4KICAgICAgICAgICAgICAgICAgICA8ZW1haWw+dmlhZ2Vuc0BncnVwb3pl
bG8uY29tPC9lbWFpbD4KICAgICAgICAgICAgICAgIDwvdG9tYT4KICAgICAgICAgICAgICAgIDxz
ZXJ2PgogICAgICAgICAgICAgICAgICAgIDxsb2NQcmVzdD4KICAgICAgICAgICAgICAgICAgICAg
ICAgPGNMb2NQcmVzdGFjYW8+MzEwNjIwMDwvY0xvY1ByZXN0YWNhbz4KICAgICAgICAgICAgICAg
ICAgICA8L2xvY1ByZXN0PgogICAgICAgICAgICAgICAgICAgIDxjU2Vydj4KICAgICAgICAgICAg
ICAgICAgICAgICAgPGNUcmliTmFjPjA5MDIwMTwvY1RyaWJOYWM+CiAgICAgICAgICAgICAgICAg
ICAgICAgIDxjVHJpYk11bj4wMDE8L2NUcmliTXVuPgogICAgICAgICAgICAgICAgICAgICAgICA8
eERlc2NTZXJ2PjkuMiBBR0VOQ0lBTUVOVE8gREUgVFVSSVNNTyAtIElTUwogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgRmF0dXJhICM0MzY0NDUgfCBWYWxvciBkYXMgZGVkdWNvZXMgcmVmZXJl
LXNlIGEgc2ltcGxlcyByZXBhc3NlIGRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1l
cmFyaW8gZG9zIHNlcnZpY29zIHByZXN0YWRvcyBwb3IgdGVyY2Vpcm9zIGNvbmZvcm1lIGZhdHVy
YS4gTmFvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmNpZGVuY2lhIGRvIElTU1FOIChE
ZWNyZXRvIG4uIDE3LjE3NCwgZGUgMjcvMDkvMjAxOSwgYXJ0LjE0NCkgfAogICAgICAgICAgICAg
ICAgICAgICAgICAgICAgU3VqZWl0YSBhIHJldGVuY2FvIGRlIElSUEogQXV0byByZXRlbmNhbyBj
b25mb3JtZSBJTiBTUkYgbi4gMTUzLzg3KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVm
ZXJlbnRlIGE6IDI2LjM2Ni4wNTIvMDAwMS03MCAtIENJQSBCUkFTSUxFSVJBIERFIFBMQU5PUyBG
VU5FUkFSSU9TCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNQVRSSVo8L3hEZXNjU2Vydj4K
ICAgICAgICAgICAgICAgICAgICA8L2NTZXJ2PgogICAgICAgICAgICAgICAgICAgIDxpbmZvQ29t
cGw+CiAgICAgICAgICAgICAgICAgICAgICAgIDx4SW5mQ29tcD5GYXR1cmEgIzQzNjQ0NSB8IFZh
bG9yIGRhcyBkZWR1Y29lcyByZWZlcmUtc2UgYSBzaW1wbGVzIHJlcGFzc2UgZGUKICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIG51bWVyYXJpbyBkb3Mgc2Vydmljb3MgcHJlc3RhZG9zIHBvciB0
ZXJjZWlyb3MgY29uZm9ybWUgZmF0dXJhLiBOYW8KICAgICAgICAgICAgICAgICAgICAgICAgICAg
IGluY2lkZW5jaWEgZG8gSVNTUU4gKERlY3JldG8gbi4gMTcuMTc0LCBkZSAyNy8wOS8yMDE5LCBh
cnQuMTQ0KSB8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdWplaXRhIGEgcmV0ZW5jYW8g
ZGUgSVJQSiBBdXRvIHJldGVuY2FvIGNvbmZvcm1lIElOIFNSRiBuLgogICAgICAgICAgICAgICAg
ICAgICAgICAgICAgMTUzLzg3KVJlZmVyZW50ZSBhOiAyNi4zNjYuMDUyLzAwMDEtNzAgLSBDSUEg
QlJBU0lMRUlSQSBERSBQTEFOT1MKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZVTkVSQVJJ
T1MgTUFUUklaPC94SW5mQ29tcD4KICAgICAgICAgICAgICAgICAgICA8L2luZm9Db21wbD4KICAg
ICAgICAgICAgICAgIDwvc2Vydj4KICAgICAgICAgICAgICAgIDx2YWxvcmVzPgogICAgICAgICAg
ICAgICAgICAgIDx2U2VydlByZXN0PgogICAgICAgICAgICAgICAgICAgICAgICA8dlNlcnY+MjMy
LjkzPC92U2Vydj4KICAgICAgICAgICAgICAgICAgICA8L3ZTZXJ2UHJlc3Q+CiAgICAgICAgICAg
ICAgICAgICAgPHRyaWI+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0cmliTXVuPgogICAgICAg
ICAgICAgICAgICAgICAgICAgICAgPHRyaWJJU1NRTj4xPC90cmliSVNTUU4+CiAgICAgICAgICAg
ICAgICAgICAgICAgICAgICA8dHBSZXRJU1NRTj4xPC90cFJldElTU1FOPgogICAgICAgICAgICAg
ICAgICAgICAgICA8L3RyaWJNdW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0b3RUcmliPgog
ICAgICAgICAgICAgICAgICAgICAgICAgICAgPGluZFRvdFRyaWI+MDwvaW5kVG90VHJpYj4KICAg
ICAgICAgICAgICAgICAgICAgICAgPC90b3RUcmliPgogICAgICAgICAgICAgICAgICAgIDwvdHJp
Yj4KICAgICAgICAgICAgICAgIDwvdmFsb3Jlcz4KICAgICAgICAgICAgPC9pbmZEUFM+CiAgICAg
ICAgICAgIDxTaWduYXR1cmUgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNp
ZyMiPgogICAgICAgICAgICAgICAgPFNpZ25lZEluZm8+CiAgICAgICAgICAgICAgICAgICAgPENh
bm9uaWNhbGl6YXRpb25NZXRob2QKICAgICAgICAgICAgICAgICAgICAgICAgQWxnb3JpdGhtPSJo
dHRwOi8vd3d3LnczLm9yZy9UUi8yMDAxL1JFQy14bWwtYzE0bi0yMDAxMDMxNSIgLz4KICAgICAg
ICAgICAgICAgICAgICA8U2lnbmF0dXJlTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5v
cmcvMjAwMC8wOS94bWxkc2lnI3JzYS1zaGExIiAvPgogICAgICAgICAgICAgICAgICAgIDxSZWZl
cmVuY2UgVVJJPSIjRFBTMzEwNjIwMDIzMDM0MjI2NjAwMDE4MzAxMDAxMDAwMDAwMDAwMDEwODI2
Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPFRyYW5zZm9ybXM+CiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICA8VHJhbnNmb3JtCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWxn
b3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjZW52ZWxvcGVkLXNpZ25h
dHVyZSIgLz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxUcmFuc2Zvcm0gQWxnb3JpdGht
PSJodHRwOi8vd3d3LnczLm9yZy9UUi8yMDAxL1JFQy14bWwtYzE0bi0yMDAxMDMxNSIgLz4KICAg
ICAgICAgICAgICAgICAgICAgICAgPC9UcmFuc2Zvcm1zPgogICAgICAgICAgICAgICAgICAgICAg
ICA8RGlnZXN0TWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxk
c2lnI3NoYTEiIC8+CiAgICAgICAgICAgICAgICAgICAgICAgIDxEaWdlc3RWYWx1ZT5sYWlTdFFS
RWZZbnhqUWtHVmdQNkNhc3hydEU9PC9EaWdlc3RWYWx1ZT4KICAgICAgICAgICAgICAgICAgICA8
L1JlZmVyZW5jZT4KICAgICAgICAgICAgICAgIDwvU2lnbmVkSW5mbz4KICAgICAgICAgICAgICAg
IDxTaWduYXR1cmVWYWx1ZT4KICAgICAgICAgICAgICAgICAgICBRaFQ5NDN0bGp2ZjMzMzRnOWFL
cWFDV1ZxenRRdHZtcFNIWFdxa3pqMFZPa3NVU1VLU0hJMHUxMzRnd3l1OUtTV2ovclVzVnk2b1U2
VDVhMENMWmVUQnZDV2RKN0VqcUgzVUh5OE5hdmUxbjhiV01Ma25VcEhKaXMxVXBlcVFMbWJKeGIr
Mk1zOUZtazQ0ZE5hN2gyVFQ4RUJxZUVuYnp2ZG1QRnMzS3V2MFNaK3gzNG9oa2IybE4vSXRoaUNV
dlM1ekNoanlMQXBHRkZoWjNsa0ovZWJsTkFRb2tKbUpnVGxKWEowNEx2QTBZYmYrekppRURVdGV4
K1BuSWlFanFVMmR1aHR4T0h0NVNTSGlVbmEwVGVjK0FlYWgwM2UreXVUZXArTXI5Y2ttQ2hXNEI4
bDZXNXI3aUZXem1BUTdmUEtKMmNveVlLaHJRblFxdzB6N0FsR2c9PTwvU2lnbmF0dXJlVmFsdWU+
CiAgICAgICAgICAgICAgICA8S2V5SW5mbz4KICAgICAgICAgICAgICAgICAgICA8WDUwOURhdGE+
CiAgICAgICAgICAgICAgICAgICAgICAgIDxYNTA5Q2VydGlmaWNhdGU+CiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICBNSUlIL3pDQ0JlZWdBd0lCQWdJS1phbEhacERJejZ2dCtqQU5CZ2txaGtp
Rzl3MEJBUXNGQURCZ01Rc3dDUVlEVlFRR0V3SkNVakVXTUJRR0ExVUVDd3dOUVVNZ1UzbHVaM1Zz
WVhKSlJERVRNQkVHQTFVRUNnd0tTVU5RTFVKeVlYTnBiREVrTUNJR0ExVUVBd3diUVVNZ1UyOXNk
V05oYnlCRWFXZHBkR0ZzSUUxMWJIUnBjR3hoTUI0WERUSTFNVEV3TlRFNE5UTXdNMW9YRFRJMk1U
RXdOVEU0TlRNd00xb3dnYzh4Q3pBSkJnTlZCQVlUQWtKU01STXdFUVlEVlFRS0RBcEpRMUF0UW5K
aGMybHNNU0l3SUFZRFZRUUxEQmxEWlhKMGFXWnBZMkZrYnlCRWFXZHBkR0ZzSUZCS0lFRXhNUmt3
RndZRFZRUUxEQkJXYVdSbGIyTnZibVpsY21WdVkybGhNUmN3RlFZRFZRUUxEQTR6TVRrd05Ea3hP
REF3TURFNU9URWtNQ0lHQTFVRUN3d2JRVU1nVTI5c2RXTmhieUJFYVdkcGRHRnNJRTExYkhScGNH
eGhNUzB3S3dZRFZRUUREQ1JQVGtaTVdTQlVSVU5PVDB4UFIwbEJJRXhVUkVFNk16QXpOREl5TmpZ
d01EQXhPRE13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLQW9JQkFRQ3o2U3ZU
UlByVS9UeXdpTXoxNGdOT1pvWGl4VkFBdkRNcDd5aFpSVDVhWW9DL0NOSi9qbW90S2tzR2pUR0pI
ZDRsT21HL3gwOGhKZDM4NzZDZUVqcmhPS01aMWtIUHBwZHBCNTBEZkVPMldreW1FRTRVaW11TFA1
UkhsSEM3TmhoQktGZ1loMDBvNDVWcVlSanR6ODF1bkRhdTBpU2VmdUs3VGV2OXlwaEU1WlJMM1M5
a1pXbDRMSnZCN0p1ZXF3TmtHNXNaVDh5bVIrSUZ1K1FLUVhPTjUrUVE3UC9PZHF1YmR1aUJlL0pP
ZXpjOGJPTktUNVJNRDlOSHFVU3p0NEdQcjRsWlhlcG1Wd2NQYUp5WTdZMFVlSzNMaDBBM0pnK3Bv
V1U2cHhDZW95M1JnbjZEejFTbUVaTXMvSU9TMVYrRXNSRkcvN3kva1Q3SmVxY0VLWnN4QWdNQkFB
R2pnZ05KTUlJRFJUQU9CZ05WSFE4QkFmOEVCQU1DQmVBd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFV
SEF3UUdDQ3NHQVFVRkJ3TUNNQWtHQTFVZEV3UUNNQUF3SHdZRFZSMGpCQmd3Rm9BVWEzYnh1QVJD
WkZFN3hkRTNIWXZtVE5qa0JoRXdIUVlEVlIwT0JCWUVGRkExSjVoQ1I4dmZxVmYrSzhEaHBsd1Ri
UWp5TUlHSEJnZ3JCZ0VGQlFjQkFRUjdNSGt3ZHdZSUt3WUJCUVVITUFLR2EyaDBkSEE2THk5emVX
NW5kV3hoY21sa0xtTnZiUzVpY2k5eVpYQnZjMmwwYjNKcGJ5OWhZeTF6YjJ4MVkyRnZaR2xuYVhS
aGJDMXRkV3gwYVhCc1lTOWpaWEowYVdacFkyRmtiM012WVdNdGMyOXNkV05oYjJScFoybDBZV3d0
YlhWc2RHbHdiR0V1Y0RkaU1JR09CZ05WSFNBRWdZWXdnWU13Z1lBR0IyQk1BUUlCZ1Jjd2RUQnpC
Z2dyQmdFRkJRY0NBUlpuYUhSMGNITTZMeTl6ZVc1bmRXeGhjbWxrTG1OdmJTNWljaTl5WlhCdmMy
bDBiM0pwYnk5aFl5MXpiMngxWTJGdlpHbG5hWFJoYkMxdGRXeDBhWEJzWVM5a2NHTXZaSEJqTFdG
akxYTnZiSFZqWVc5a2FXZHBkR0ZzTFcxMWJIUnBjR3hoTG5Ca1pqQ0J1QVlEVlIwUkJJR3dNSUd0
b0I4R0JXQk1BUU1Db0JZRUZFVk1Wa2xUSUUxQlVsUkpUbE1nVTA5QlVrVlRvQmtHQldCTUFRTURv
QkFFRGpNd016UXlNalkyTURBd01UZ3pvRUlHQldCTUFRTUVvRGtFTnpFeE1EZ3hPVGt3TURjeU9E
TXhOamMyTlRBd01EQXdNREF3TURBd01EQXdNREF3TURBd01EQXdNREF3TURBd01EQXdNREF3TURD
Z0Z3WUZZRXdCQXdlZ0RnUU1NREF3TURBd01EQXdNREF3Z1JKbGJIWnBjMEJ2Ym1ac2VTNWpiMjB1
WW5Jd2dmSUdBMVVkSHdTQjZqQ0I1ekJzb0dxZ2FJWm1hSFIwY0RvdkwzTjVibWQxYkdGeWFXUXVZ
Mjl0TG1KeUwzSmxjRzl6YVhSdmNtbHZMMkZqTFhOdmJIVmpZVzlrYVdkcGRHRnNMVzExYkhScGNH
eGhMMnhqY2k5c1kzSXRZV010YzI5c2RXTmhiMlJwWjJsMFlXd3RiWFZzZEdsd2JHRXVZM0pzTUhl
Z2RhQnpobkZvZEhSd09pOHZhV053TFdKeVlYTnBiQzV6ZVc1bmRXeGhjbWxrTG1OdmJTNWljaTl5
WlhCdmMybDBiM0pwYnk5aFl5MXpiMngxWTJGdlpHbG5hWFJoYkMxdGRXeDBhWEJzWVM5c1kzSXZi
R055TFdGakxYTnZiSFZqWVc5a2FXZHBkR0ZzTFcxMWJIUnBjR3hoTG1OeWJEQU5CZ2txaGtpRzl3
MEJBUXNGQUFPQ0FnRUFQcm5odVFpWUMvb2NDQ3pzUjdNOE1PR0FMa1ZSYVpBaW5NMHIrdzB6RGt1
bkdXQnEwTjgzZVE2L1ZGeVYzWUJxazdwQVZvOXBHM2l6MENYOG54ajg1L3k3Y0F0NzF1STEzNXFW
b2NGazFRZG9QbkRtS3RORktaamt6c01VUTVBWjVnTHJTSmNUZlZUdkMvVmFkNVdBS1JtdWlUKzhB
YndGZE9BUU9oVkFaSUhXK2VyaFpaaWFNUmdMV1ZIcE1YZ3pPcXNtSnl2UjkwUERqM2tQdmJKZHIw
d2FBYjBWSUlodndKZGFscnR3UEV4NmdNVlJYbWloWUFhUlY1TEw3VEt2Y3NvaW5aQjFkc01ZWFFj
SlRYa1VuUk5yVS8yWTV3K3VlcUk4MTI5OWpmcitKSGU4VXBhajA0QTBKUTRQejZNRXV1WEFUQzJE
WGVMTHdBVXdFMnVsK2ZCbDBRQ0c3M0Q1ZU5CbThxTFlsWDd6czlsVkh4ZFJZTG0zN0UwdE1ldDVx
Ty9UNVpGdGRWWDRPczMwNm9ObW9xVkNQSEJ0QkhvNXRCQks1Yi9FbTdHbkhqdjFiS0tUcG1KOXRJ
bEVac3h5WDFxLy9MQTJMVkQyQWZqMHFJSUgrSERjYVhPUDYxdHJCbzFvWHpnWVpUWkpUS2YwNUc3
OWZjQzJGTEwzdFRCcnFyR290SUVxdTdhZWhnTW5hR2RrTXpFUUs0TU1xRFJOUFdvRGtBNXhYbm91
eGo3N3crQjRjbndid0FaRXhZUlNJNmJ6blppejV6SmhrN1pQd0VINUlVYjZkUnFvbVdWZkY4elpa
c2ZwckZYWFVRUU54WmcwRXhTQnpNTE5lN3hybnlkMnFOYkRpczFSYXpzNllaa3BIS1pUbTVjTERy
NmZNK284dmo2STNsZz08L1g1MDlDZXJ0aWZpY2F0ZT4KICAgICAgICAgICAgICAgICAgICA8L1g1
MDlEYXRhPgogICAgICAgICAgICAgICAgPC9LZXlJbmZvPgogICAgICAgICAgICA8L1NpZ25hdHVy
ZT4KICAgICAgICA8L0RQUz4KICAgIDwvaW5mTkZTZT4KICAgIDxTaWduYXR1cmUgeG1sbnM9Imh0
dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiPgogICAgICAgIDxTaWduZWRJbmZvPgog
ICAgICAgICAgICA8Q2Fub25pY2FsaXphdGlvbk1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cu
dzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuI1dpdGhDb21tZW50cyIgLz4KICAgICAgICAgICAg
PFNpZ25hdHVyZU1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMDQveG1s
ZHNpZy1tb3JlI3JzYS1zaGEyNTYiIC8+CiAgICAgICAgICAgIDxSZWZlcmVuY2UgVVJJPSIjTkZT
MzEwNjIwMDIyMzAzNDIyNjYwMDAxODMwMDAwMDAwMDEwODA5MjYwMTE5Mzk5NDY1NjIiPgogICAg
ICAgICAgICAgICAgPFRyYW5zZm9ybXM+CiAgICAgICAgICAgICAgICAgICAgPFRyYW5zZm9ybSBB
bGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2ln
bmF0dXJlIiAvPgogICAgICAgICAgICAgICAgICAgIDxUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRw
Oi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biNXaXRoQ29tbWVudHMiIC8+CiAgICAg
ICAgICAgICAgICA8L1RyYW5zZm9ybXM+CiAgICAgICAgICAgICAgICA8RGlnZXN0TWV0aG9kIEFs
Z29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjc2hhMjU2IiAvPgogICAg
ICAgICAgICAgICAgPERpZ2VzdFZhbHVlPmFBR0tENXR3OHVHOXE3OEgxYWUrdHZsK2Z2ZVdOM0pD
WU9vSU1BZkdHd0k9PC9EaWdlc3RWYWx1ZT4KICAgICAgICAgICAgPC9SZWZlcmVuY2U+CiAgICAg
ICAgPC9TaWduZWRJbmZvPgogICAgICAgIDxTaWduYXR1cmVWYWx1ZT4KICAgICAgICAgICAgZWpo
a1V4NU5VR0huSTFhenJGendoOUhOazBRN3o0SHlZNy9kWklDVnNXSWpQQkpZWCtCWi9OYk1kSWJp
d2dsckpjMHQ4RTJ3cGVQeFVVMG1OVmlVK1NyTnAzalc0Qm5LUWR4S295VW9rNWI0dTd3N082Z1A4
Qis2TVVmS285SHVEZC9HUVJQWlozTlpwS2FrYlJtdlJsYm9Wb1JhZ1dSWmFmQ2JldkplRWdVV3FI
R3pQYzEyYkVMWnB0ZG1tR1FjL0FpMUl0Vll6TkVSSVFvOVJTM09xbVNmcUs5S1Z1Q1FUYmpEVlBw
ZlRTUVh3TXVJdEhJa09lU2hlU2ZGWGpFeW5lMzlCcnJ3OW43d0k2Ykhzb0g0bWw4RGYrblBqQVRW
QzgrMzd0WTdrQTlOSDNVWjRSZ09zbzFHa0xmQzBuRjJZSy9nVlRIQk15Ty9mdG4zcEo0UG9RPT08
L1NpZ25hdHVyZVZhbHVlPgogICAgICAgIDxLZXlJbmZvPgogICAgICAgICAgICA8WDUwOURhdGE+
CiAgICAgICAgICAgICAgICA8WDUwOUNlcnRpZmljYXRlPgogICAgICAgICAgICAgICAgICAgIE1J
SUhQRENDQmFTZ0F3SUJBZ0lRSXVLbytQQmhJc3grZklRWXo4bm1BakFOQmdrcWhraUc5dzBCQVFz
RkFEQmdNUXN3Q1FZRFZRUUdFd0pIUWpFWU1CWUdBMVVFQ2hNUFUyVmpkR2xuYnlCTWFXMXBkR1Zr
TVRjd05RWURWUVFERXk1VFpXTjBhV2R2SUZCMVlteHBZeUJUWlhKMlpYSWdRWFYwYUdWdWRHbGpZ
WFJwYjI0Z1EwRWdUMVlnVWpNMk1CNFhEVEkxTURreU16QXdNREF3TUZvWERUSTJNRGt5TmpJek5U
azFPVm93ZlRFTE1Ba0dBMVVFQmhNQ1FsSXhHVEFYQmdOVkJBZ1RFRVJwYzNSeWFYUnZJRVpsWkdW
eVlXd3hPekE1QmdOVkJBb1RNbE5GVWxaSlEwOGdSa1ZFUlZKQlRDQkVSU0JRVWs5RFJWTlRRVTFG
VGxSUElFUkZJRVJCUkU5VElDaFRSVkpRVWs4cE1SWXdGQVlEVlFRRERBMHFMbTVtYzJVdVoyOTJM
bUp5TUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUFoVEdkZmxTTEpJ
VEtweW05c21sMFRCRmJyUFFHY1pPSStoczVySFJPNHFOMlRjQVZ2UFQ1RUM3QWd5U01pOVdMU0dm
bFVYTHdjQkhPcHJ6SFZOVE5LNlBiYjU1OTQrTVlZWFVNbzUxanhpVXM2OCtLRVo3N3Fua05xbUsy
a09hOS94WHQ2NEFMT3ZZZHlIUSsra25EcTNDSnNGUnJNZUJNL3Ztb3h2SmhqNlNwWEVHOHZqL2RP
RFFYMDlreUxMdTBaR0JkbTArKzFMUWtyLzdxdEE2bXc5TURqTDFGbFhtcWZRRkEzMkMwbGF6bDVF
MWhDd094R09jb0gzZzJGYnQwc2s3WWlmU3RXVVl4ZzY1d3N2YU5qa2VrcTdUU0U1eFlySVFKcmFu
V2pTUjJ6RTA1U0dad0RTMElNK1kyRnhLNGhZTld3VFo4cXR1OFBNTWg2VzluM3dJREFRQUJvNElE
VXpDQ0EwOHdId1lEVlIwakJCZ3dGb0FVNDJaMHUzQm9qU3hkVGc2bVNvK2JOeUtjZ3BJd0hRWURW
UjBPQkJZRUZLanlhZ2VNcUhNZHVVeGM4c3NJNkdueTc5d3ZNQTRHQTFVZER3RUIvd1FFQXdJRm9E
QU1CZ05WSFJNQkFmOEVBakFBTUIwR0ExVWRKUVFXTUJRR0NDc0dBUVVGQndNQkJnZ3JCZ0VGQlFj
REFqQktCZ05WSFNBRVF6QkJNRFVHRENzR0FRUUJzakVCQWdFREJEQWxNQ01HQ0NzR0FRVUZCd0lC
Rmhkb2RIUndjem92TDNObFkzUnBaMjh1WTI5dEwwTlFVekFJQmdabmdRd0JBZ0l3VkFZRFZSMGZC
RTB3U3pCSm9FZWdSWVpEYUhSMGNEb3ZMMk55YkM1elpXTjBhV2R2TG1OdmJTOVRaV04wYVdkdlVI
VmliR2xqVTJWeWRtVnlRWFYwYUdWdWRHbGpZWFJwYjI1RFFVOVdVak0yTG1OeWJEQ0JoQVlJS3dZ
QkJRVUhBUUVFZURCMk1FOEdDQ3NHQVFVRkJ6QUNoa05vZEhSd09pOHZZM0owTG5ObFkzUnBaMjh1
WTI5dEwxTmxZM1JwWjI5UWRXSnNhV05UWlhKMlpYSkJkWFJvWlc1MGFXTmhkR2x2YmtOQlQxWlNN
ell1WTNKME1DTUdDQ3NHQVFVRkJ6QUJoaGRvZEhSd09pOHZiMk56Y0M1elpXTjBhV2R2TG1OdmJU
QWxCZ05WSFJFRUhqQWNnZzBxTG01bWMyVXVaMjkyTG1KeWdndHVabk5sTG1kdmRpNWljakNDQVg0
R0Npc0dBUVFCMW5rQ0JBSUVnZ0Z1QklJQmFnRm9BSFlBMkFsVk81UlBldi9JRmhsdmxFK0ZxN0Q0
L0Y2SFZTWVBGZEV1Y3J0RlN4UUFBQUdaZFZWNXZBQUFCQU1BUnpCRkFpQmR5dmxENzhucTJ4Y0Zh
UkJOZEJ5VUszWU9UKzV4aWt1NkFmYmRmbGRmK3dJaEFKaEZMd2NJWko2ZDgyMTVPL2ZPSWxmNGlD
RTJyaDlhQVFpSnBsaXM0QzNEQUhZQXIyZUlPMWV3VHQyUHB0bCs5aTZvNjRFS3gzRmc4Q1JlVmRZ
TUwrZUZoem9BQUFHWmRWVjZGd0FBQkFNQVJ6QkZBaUF6bEt4WFY2VWFYa1RsNEo4bmFPazhidHlv
ZFZodkFkYkN5dGMyZTN4WkV3SWhBSlRteWtxZ1UrWmxwS04vSGJTT1R5Zit6SFRBeVIyQ3RNYndl
cWFXUU9ucUFIWUExMjE5RU5HbjlYZkN4K2xmMXdDLytZTEpNMXBsNGRDekFYTVh3TWpGYVhjQUFB
R1pkVlY1WXdBQUJBTUFSekJGQWlCazlTd3lSenJ3NEtBNTlBV25CRnFxazR5eDlmaUxsK3ZXNG5H
NUMyV0hhUUloQUltZWYydDVFcmRiTmVjYThWT09jSUhWYjBiaWtSZGd4NTJSVzNWOXA0Q01NQTBH
Q1NxR1NJYjNEUUVCQ3dVQUE0SUJnUUE2Z1pDcnpLZGRwN2sxekl1d2lYbUYwQklVK3haMWh0RnNX
dTd2bUpMU2JNSVAzR0o1UnduL09nVFZpY0NYSE5JQmxuL2pTcEl0ZmpKengwaVdUQ0NoMVRVai82
V1hnRTBJRzVvb0dWbWdYdXQzamNMdXNtdXhiOUN2cXpVK1V5K3FtYS9CdlR2c1JUcm9KS0hjbC92
QmRPaVhpNmc0Z01UOHJ3ditWN3NhUGF1MXBiSVlQRFFENjJ1QTVkaVVFVmE5dmFxR0JnOVI4TTd5
ZzAvNU5Id2svbEdZcUFEdnBvQU5DMFFFeFNqbi9pd0c3ZWNZM1Y3dzNtc3NMQ2V3MUorRHZZUFZO
Qmw0MzZYcWFPcFRzVFBHV2ZrMk1sSDhEVzJpTWNoYVEyWkJqYlhpY1pXUExZRkQ1bFBOTUoxL0V3
QUVUemNRZEcyVlM5V1V2ek52VTFNcU5ncVFSeUlDd3VKL0k4NHhmYU5rSFRuSlRyQXdqVEVHVDli
QUtBdkg2dE5LdFdZUlNTZTR0bFczQkMyZXJlTWRKY0EzYkxJVGVUK3oxK2lsZE1hdUhudmdJSGt5
SjdaQUpNMm0vaW5RdHZMdThoeEJLbWc5dWNMb2ZaTnUrMmJmbTBaL0tpZ0xMYWdhNkRwckJGSDRw
am1TSmhJOGVwRnFGbVhHQXBEZ3NBTT08L1g1MDlDZXJ0aWZpY2F0ZT4KICAgICAgICAgICAgPC9Y
NTA5RGF0YT4KICAgICAgICA8L0tleUluZm8+CiAgICA8L1NpZ25hdHVyZT4KPC9ORlNlPg==''',
    'xml_evento': """
    PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHBlZFJlZ0V2ZW50byB4bWxu
cz0iaHR0cDovL3d3dy5zcGVkLmZhemVuZGEuZ292LmJyL25mc2UiIHZlcnNhbz0iMS4wMCI+CiAg
ICA8aW5mUGVkUmVnIElkPSJQUkU0MTIzMTIwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAw
MDAwMDAwMDEwMTEwMTAwMSI+CiAgICAgICAgPHRwQW1iPjE8L3RwQW1iPiA8dmVyQXBsaWM+MS4w
LjA8L3ZlckFwbGljPgogICAgICAgIDxDTlBKQXV0b3I+MDAwMDAwMDAwMDAxOTE8L0NOUEpBdXRv
cj4KICAgICAgICA8Y2hORlNlPjQxMjMxMjAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAw
MDAwMDAwPC9jaE5GU2U+IDxuUGVkUmVnRXZlbnRvPjAwMTwvblBlZFJlZ0V2ZW50bz4KICAgICAg
ICAKICAgICAgICA8ZTEwMTEwMT4KICAgICAgICAgICAgPHhEZXNjPkNhbmNlbGFtZW50byBkZSBO
RlMtZTwveERlc2M+IDxjTW90aXZvPjE8L2NNb3Rpdm8+IDx4TW90aXZvPkVycm8gbmEgZGlnaXRh
w6fDo28gZG9zIHZhbG9yZXMgZG8gc2VydmnDp28gcHJlc3RhZG88L3hNb3Rpdm8+IDwvZTEwMTEw
MT4KICAgIDwvaW5mUGVkUmVnPgo8L3BlZFJlZ0V2ZW50bz4="""
    }})